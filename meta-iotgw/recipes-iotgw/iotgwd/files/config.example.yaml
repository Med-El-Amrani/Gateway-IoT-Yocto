version: 1

gateway:
  name: "iotgw-rpi4"
  timezone: "Europe/Paris"
  loglevel: "info"
  logfile: "/var/log/iotgw.log"
  metrics_port: 9100

# Les fragments de protocole à inclure
includes:
  - /etc/iotgw.d/mqtt.yaml
  - /etc/iotgw.d/modbus_rtu.yaml
  - /etc/iotgw.d/http_server.yaml

# Connecteurs supplémentaires directement dans le master
connectors:
  # Exemple direct (en plus des includes)
  local_http:
    type: http-server
    params:
      bind: "0.0.0.0:8081"

# Routes (bridges) entre connecteurs
bridges:
  modbus_to_mqtt:
    from: modbus_rtu_1
    to: mqtt_local
    mapping:
      topic: "sensors/${unit_id}"
      format: json
      fields: ["temp", "hum"]
      timestamp: true

  mqtt_to_http:
    from: mqtt_local
    to: local_http
    mapping:
      topic: "iotgw/http"
      format: kv
      fields: ["temp", "hum"]
