{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "schemas/modbus_tcp.schema.json",
  "title": "Modbus TCP connector",
  "type": "object",
  "required": ["params"],
  "properties": {
    "type":{"const":"modbus-tcp"},
    "params": {
      "type": "object",
      "required": ["host", "port", "unit_id", "timeout_ms", "map"],
      "properties": {
        "host": {
          "type": "string",
          "pattern": "^(([a-zA-Z0-9-]+\\.)*[a-zA-Z0-9-]+|\\d{1,3}(\\.\\d{1,3}){3})$"
        },
        "port": { "type": "integer", "minimum": 1, "maximum": 65535, "default": 502 },
        "unit_id": { "type": "integer", "minimum": 0, "maximum": 255, "default": 1 },
        "timeout_ms": { "type": "integer", "minimum": 50, "maximum": 5000 },
        "retries": { "type": "integer", "minimum": 0, "maximum": 10, "default": 2 },
        "map": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["name", "func", "addr", "count", "type"],
            "properties": {
              "name":  { "type": "string", "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$" },
              "func":  { "type": "string", "enum": ["holding", "input", "coil", "discrete"] },
              "addr":  { "type": "integer", "minimum": 0, "maximum": 65535 },
              "count": { "type": "integer", "minimum": 1, "maximum": 4 },
              "type":  { "type": "string", "enum": ["u16","s16","u32","s32","float","double"] },
              "scale": { "type": "number" },
              "signed":{ "type": "boolean" }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
